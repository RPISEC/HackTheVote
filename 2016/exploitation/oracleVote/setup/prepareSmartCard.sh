#!/bin/sh
export NAME="$1"
if [ -z "$NAME" ]; then
    export NAME=SmartCard
fi

echo Compiling "${NAME}.java"

javac "${NAME}.java"

echo Packing "${NAME}"*.class into "${NAME}.jar"

jar cf "${NAME}.jar" "${NAME}"*.class

echo Formatting "${NAME}.jar" into "${NAME}.smartcard"

python -c \
"linewrap = lambda s: '\n'.join(s[i*80:(i+1)*80] for i in range(1+(len(s)/80)));"\
"print('--- BEGIN ORACLEVOTE SMARTCARD ---');"\
"print(linewrap(open('${NAME}.jar').read().encode('hex')));"\
"print('--- END ORACLEVOTE SMARTCARD ---')" \
    > "${NAME}.smartcard"
